// Generated by CoffeeScript 1.10.0
(function() {
  var dependencies;

  dependencies = ['Utils/Utils', 'Tools/Tool', 'UI/Button', 'Tools/MoveTool', 'Tools/SelectTool', 'Tools/PathTool', 'Tools/EraserTool', 'Tools/ItemTool', 'Tools/TextTool', 'Tools/GradientTool'];

  if (typeof document !== "undefined" && document !== null) {
    dependencies.push('Tools/CarTool');
  }

  define('Tools/ToolManager', dependencies, function(Utils, Tool, Button, MoveTool, SelectTool, PathTool, EraserTool, ItemTool, TextTool, GradientTool, CarTool) {
    var ToolManager;
    ToolManager = (function() {
      function ToolManager() {
        var defaultFavoriteTools, error, error1;
        R.ToolsJ = $(".tool-list");
        R.favoriteToolsJ = $("#FavoriteTools .tool-list");
        R.allToolsContainerJ = $("#AllTools");
        R.allToolsJ = R.allToolsContainerJ.find(".all-tool-list");
        R.favoriteTools = [];
        if (typeof localStorage !== "undefined" && localStorage !== null) {
          try {
            R.favoriteTools = JSON.parse(localStorage.favorites);
          } catch (error1) {
            error = error1;
            console.log(error);
          }
        }
        R.tools.move = new R.Tools.Move();
        R.tools.select = new R.Tools.Select();
        R.tools.eraser = new R.Tools.Eraser();
        defaultFavoriteTools = [];
        while (R.favoriteTools.length < 8 && defaultFavoriteTools.length > 0) {
          Utils.Array.pushIfAbsent(R.favoriteTools, defaultFavoriteTools.pop().label);
        }
        R.tools.move.select();
        R.wacomPlugin = document.getElementById('wacomPlugin');
        if (R.wacomPlugin != null) {
          R.wacomPenAPI = wacomPlugin.penAPI;
          R.wacomTouchAPI = wacomPlugin.touchAPI;
          R.wacomPointerType = {
            0: 'Mouse',
            1: 'Pen',
            2: 'Puck',
            3: 'Eraser'
          };
        }
        this.createZoombuttons();
        this.createUndoRedoButtons();
        return;
      }

      ToolManager.prototype.zoom = function(value, snap) {
        var bounds, i, j, len, len1, newZoom, v, zoomValues;
        if (snap == null) {
          snap = true;
        }
        if (P.view.zoom * value < 0.125 || P.view.zoom * value > 4) {
          return;
        }
        bounds = R.view.getViewBounds(true);
        if (value < 1 && bounds.contains(R.view.grid.limitCD.bounds)) {
          return;
        }
        if (bounds.contains(R.view.grid.limitCD.bounds.scale(value))) {
          R.view.fitRectangle(R.view.grid.limitCD.bounds.expand(200), true);
          return;
        }
        if (snap) {
          newZoom = 1;
          zoomValues = [0.25, 0.5, 1, 2, 4];
          if (value < 1) {
            for (i = 0, len = zoomValues.length; i < len; i++) {
              v = zoomValues[i];
              if (P.view.zoom > v) {
                newZoom = v;
              } else {
                break;
              }
            }
          } else {
            for (j = 0, len1 = zoomValues.length; j < len1; j++) {
              v = zoomValues[j];
              if (P.view.zoom < v) {
                newZoom = v;
                break;
              }
            }
          }
          P.view.zoom = newZoom;
        } else {
          P.view.zoom *= value;
        }
        console.log(P.view.zoom);
        this.enableDrawingButton(P.view.zoom >= 1);
        R.view.moveBy(new P.Point());
      };

      ToolManager.prototype.createZoombuttons = function() {
        this.zoomInBtn = new Button({
          name: 'Zoom +',
          iconURL: R.style === 'line' ? 'icones_icon_zoomin.png' : 'glyphicon-zoom-in',
          favorite: true,
          category: null,
          description: 'Zoom +',
          popover: true,
          order: null
        });
        this.zoomInBtn.btnJ.click((function(_this) {
          return function() {
            return _this.zoom(2);
          };
        })(this));
        this.zoomOutBtn = new Button({
          name: 'Zoom -',
          iconURL: R.style === 'line' ? 'icones_icon_zoomout.png' : 'glyphicon-zoom-out',
          favorite: true,
          category: null,
          description: 'Zoom -',
          popover: true,
          order: null
        });
        this.zoomOutBtn.btnJ.click((function(_this) {
          return function() {
            return _this.zoom(0.5);
          };
        })(this));
      };

      ToolManager.prototype.createUndoRedoButtons = function() {
        this.undoBtn = new Button({
          name: 'Undo',
          iconURL: R.style === 'line' ? 'icones_icon_back.png' : 'glyphicon-share-alt',
          favorite: true,
          category: null,
          description: 'Undo',
          popover: true,
          order: null,
          transform: 'scaleX(-1)'
        });
        this.undoBtn.btnJ.click(function() {
          return R.commandManager.undo();
        });
        this.redoBtn = new Button({
          name: 'Redo',
          iconURL: R.style === 'line' ? 'icones_icon_forward.png' : 'glyphicon-share-alt',
          favorite: true,
          category: null,
          description: 'Redo',
          popover: true,
          order: null
        });
        this.redoBtn.btnJ.click(function() {
          return R.commandManager["do"]();
        });
      };

      ToolManager.prototype.enterDrawingMode = function() {
        var id, item, ref;
        if (R.selectedTool !== R.tools['Precise path']) {
          R.tools['Precise path'].select();
        }
        ref = R.items;
        for (id in ref) {
          item = ref[id];
          if (R.items[id].owner === R.me) {
            R.drawingPanel.showSubmitDrawing();
            break;
          }
        }
      };

      ToolManager.prototype.leaveDrawingMode = function(selectTool) {
        if (selectTool == null) {
          selectTool = false;
        }
        if (selectTool) {
          R.tools.select.select(false, true, true);
        }
        R.drawingPanel.hideSubmitDrawing();
      };

      ToolManager.prototype.enableDrawingButton = function(enable) {
        if (enable) {
          R.sidebar.favoriteToolsJ.find("[data-name='Precise path']").css({
            opacity: 1
          });
        } else {
          R.sidebar.favoriteToolsJ.find("[data-name='Precise path']").css({
            opacity: 0.25
          });
        }
      };

      return ToolManager;

    })();
    return ToolManager;
  });

}).call(this);
