// Generated by CoffeeScript 1.10.0
(function() {
  define(['Utils/Utils', 'Loader', 'Socket', 'City', 'Rasterizers/RasterizerManager', 'UI/Sidebar', 'UI/DrawingPanel', 'UI/Modal', 'UI/AlertManager', 'UI/Controllers/ControllerManager', 'Commands/CommandManager', 'View/View', 'Tools/ToolManager', 'RasterizerBot', 'i18next', 'i18nextXHRBackend', 'i18nextBrowserLanguageDetector', 'jqueryI18next'], function(Utils, Loader, Socket, CityManager, RasterizerManager, Sidebar, DrawingPanel, Modal, AlertManager, ControllerManager, CommandManager, View, ToolManager, RasterizerBot, i18next, i18nextXHRBackend, i18nextBrowserLanguageDetector, jqueryI18next) {
    console.log('Main CommeUnDessein Repository');

    /*
    	 * CommeUnDessein documentation #
    
    	CommeUnDessein is an experiment about freedom, creativity and collaboration.
    
    	tododoc
    	tododoc: define RItems
    
    	The source code is divided in files:
    	 - [main.coffee](http://main.html) which is where the initialization
    	 - [path.coffee](http://path.html)
    	 - etc
    
    	Notations:
    	 - override means that the method extends functionnalities of the inherited method (super is called at some point)
    	 - redefine means that it totally replace the method (super is never called)
     */
    $(document).ready(function() {
      var modal, updateContent, userAuthenticated, username;
      updateContent = function() {
        $("body").localize();
        console.log('i18n tests:');
        console.log(i18next.t('You are logged as username', {
          username: 'username'
        }));
        console.log(i18next.t('key', {
          what: 'i18next',
          how: 'great'
        }));
      };
      i18next.use(i18nextXHRBackend).use(i18nextBrowserLanguageDetector).init({
        fallbackLng: 'en',
        debug: true,
        ns: ['special', 'common'],
        defaultNS: 'common',
        backend: {
          loadPath: 'static/locales/{{lng}}/{{ns}}.json',
          crossDomain: true
        }
      }, function(err, t) {
        updateContent();
      });
      i18next.on('languageChanged', (function(_this) {
        return function() {
          return updateContent();
        };
      })(this));
      jqueryI18next.init(i18next, $, {
        tName: 't',
        i18nName: 'i18n',
        handleName: 'localize',
        selectorAttr: 'data-i18n',
        targetAttr: 'i18n-target',
        optionsAttr: 'i18n-options',
        useOptionsAttr: false,
        parseDefaultValueFromContent: true
      });
      i18next.changeLanguage('fr');
      username = $('#canvas').attr("data-username");
      R.me = username.length > 0 ? username : null;
      userAuthenticated = $('#canvas').attr("data-is-authenticated");
      R.userAuthenticated = userAuthenticated === 'True';
      R.drawingMode = $('#canvas').attr("data-drawing-mode");
      R.catchErrors = false;
      R.ignoreSockets = false;
      R.currentPaths = {};
      R.paths = new Object();
      R.items = new Object();
      R.locks = [];
      R.divs = [];
      R.sortedPaths = [];
      R.sortedDivs = [];
      R.animatedItems = [];
      R.cars = {};
      R.currentDiv = null;
      R.selectedItems = [];
      if (location.pathname === '/rasterizer/') {
        R.rasterizerBot = new RasterizerBot(this);
        R.loader = new Loader.RasterizerLoader();
      } else {
        R.loader = new Loader();
      }
      R.socket = new Socket();
      R.sidebar = new Sidebar();
      R.cityManager = new CityManager();
      R.view = new View();
      R.alertManager = new AlertManager();
      if (typeof document !== "undefined" && document !== null) {
        R.controllerManager = new ControllerManager();
        R.controllerManager.createGlobalControllers();
      }
      R.rasterizerManager = new RasterizerManager();
      R.rasterizerManager.initializeRasterizers();
      R.view.createBackground();
      R.commandManager = new CommandManager();
      R.toolManager = new ToolManager();
      R.drawingPanel = new DrawingPanel();
      R.view.initializePosition();
      R.sidebar.initialize();
      if (!R.userAuthenticated) {
        modal = Modal.createModal({
          title: 'Welcome to Comme Un Dessein',
          submit: (function() {
            return location.pathname = '/accounts/signup/';
          }),
          postSubmit: 'load',
          submitButtonText: 'Sign up',
          submitButtonIcon: 'glyphicon-user',
          cancelButtonText: 'Just visit',
          cancelButtonIcon: 'glyphicon-sunglasses'
        });
        modal.addText('Comme un dessein is a participative piece created by the french collective IDLV (Indiens dans la Ville). \nWith the help of a simple web interface and a monumental plotter, everyone can submit a drawing which takes part of a larger pictural composition, thus compose a collective utopian artwork.', 'welcome message');
        modal.addText('Participate !');
        modal.modalJ.find('[name="cancel"]').removeClass('btn-default').addClass('btn-warning');
        modal.addButton({
          type: 'info',
          name: 'Sign in',
          icon: 'glyphicon-log-in'
        });
        modal.modalJ.find('[name="Sign in"]').attr('data-toggle', 'dropdown').after($('#user-profile').find('.dropdown-menu').clone());
        modal.modalJ.find('.dropdown-menu').find('li.sign-up').hide();
        modal.show();
      }
      R.commandManager.updateButtons();
      if (typeof window !== "undefined" && window !== null) {
        if (typeof window.setPageFullyLoaded === "function") {
          window.setPageFullyLoaded(true);
        }
      }
    });
    R.debugDatabase = function() {
      return $.ajax({
        method: "POST",
        url: "ajaxCall/",
        data: {
          data: JSON.stringify({
            "function": 'debugDatabase',
            args: {}
          })
        }
      });
    };
    R.fsi = function() {
      var ref;
      return (ref = R.selectedItems) != null ? ref[0] : void 0;
    };
    R.fi = function() {
      var itemId;
      if (R.items == null) {
        return null;
      }
      for (itemId in R.items) {
        return R.items[itemId];
      }
    };
  });

}).call(this);
